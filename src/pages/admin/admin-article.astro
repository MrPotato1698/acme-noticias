---
import Layout from "@/layouts/Layout.astro";
import { supabase } from "../../db/supabase";

const { data: articles } = await supabase.from("article").select(`
            id,
            title,
            body,
            timestamp,
            author,
            profiles!article_author_fkey(id,full_name,email)        
    `);
---

<Layout>
    <div class="max-w-7xl mx-auto py-8 px-4">
        <h1 class="text-2xl mb-6 text-gray-800 font-bold">
            Administración de artículos
        </h1>

        <div class="flex justify-end mb-4">
            <!-- Add a new article button if needed -->
        </div>

        <div class="overflow-x-auto bg-white rounded-lg shadow-md">
            <table class="w-full border-collapse">
                <thead>
                    <tr>
                        <th
                            class="p-3 text-left bg-gray-50 font-semibold border-b border-gray-100"
                            >Título</th
                        >
                        <th
                            class="p-3 text-left bg-gray-50 font-semibold border-b border-gray-100"
                            >Autor</th
                        >
                        <th
                            class="p-3 text-left bg-gray-50 font-semibold border-b border-gray-100"
                            >Categorias</th
                        >
                        <th
                            class="p-3 text-left bg-gray-50 font-semibold border-b border-gray-100"
                            >Fecha de publicación</th
                        >
                        <th
                            class="p-3 text-left bg-gray-50 font-semibold border-b border-gray-100"
                            >Acciones</th
                        >
                    </tr>
                </thead>
                <tbody>
                    {
                        articles?.map((article) => (
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 border-b border-gray-100 font-medium max-w-xs">
                                    {article.title}
                                </td>
                                <td class="p-3 border-b border-gray-100">
                                    {article.author}
                                </td>
                                <td class="p-3 border-b border-gray-100">
                                    <div class="flex flex-wrap gap-1">None</div>
                                </td>
                                <td class="p-3 border-b border-gray-100">
                                    {article.timestamp}
                                </td>
                                <td class="p-3 border-b border-gray-100 whitespace-nowrap">
                                    <button
                                        class="border-none rounded px-3 py-1.5 text-sm cursor-pointer font-medium transition-colors bg-sky-50 text-sky-600 hover:bg-sky-100 mr-2"
                                        data-id={article.id}
                                    >
                                        Editar
                                    </button>
                                    <button
                                        class="border-none rounded px-3 py-1.5 text-sm cursor-pointer font-medium transition-colors bg-red-50 text-red-600 hover:bg-red-100"
                                        data-id={article.id}
                                    >
                                        Borrar
                                    </button>
                                </td>
                            </tr>
                        ))
                    }
                </tbody>
            </table>
        </div>
    </div>
</Layout>
